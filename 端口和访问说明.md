# 端口和访问说明

## ✅ 服务已启动

**服务端口**: 8001（已修改）
**原因**: 7890端口已被其他服务占用（可能是代理服务）

---

## 🌐 访问地址

### 1. 本地访问（服务器本机）

**主页面**（图片上传）:
```
http://localhost:8001
```

**健康检查**:
```
curl http://localhost:8001/health
```

**查看已知人脸列表**:
```
curl http://localhost:8001/api/known_faces
```

---

### 2. 局域网访问（其他设备）

**主页面**:
```
http://192.168.111.172:8001
```

**本地摄像头客户端**:
```
http://192.168.111.172:8001/static/local_camera_client.html
```

---

## 🎥 摄像头功能说明

### 服务器摄像头（不可用）

**原因**: Dell Precision 7920 工作站没有摄像头硬件

**验证**:
```bash
ls /dev/video*
# 输出: No such file or directory
```

**结论**: 无法使用服务器本地摄像头

---

### 本地摄像头客户端（推荐）

#### 功能说明
- 在**有摄像头的设备**上打开网页
- 使用本地摄像头采集照片
- 自动上传到服务器识别
- 显示识别结果

#### 访问方式

**从笔记本/台式机/手机访问**:
```
http://192.168.111.172:8001/static/local_camera_client.html
```

#### 使用要求

1. **浏览器要求**:
   - ✅ Chrome（推荐）
   - ✅ Edge
   - ✅ Firefox
   - ✅ Safari（iOS/macOS）
   - ❌ 不支持旧版IE

2. **网络要求**:
   - 设备与服务器在**同一WiFi/局域网**
   - 服务器IP: 192.168.111.172
   - 服务器端口: 8001

3. **权限要求**:
   - 允许浏览器访问摄像头
   - 第一次使用时会弹出权限请求

#### 常见问题

**Q: 报错"Cannot read properties of undefined (reading 'getUserMedia')"**

**A**: 已修复！原因和解决方案：

**原因**:
- 浏览器不支持 `navigator.mediaDevices`
- 浏览器版本过旧
- 使用非HTTPS且非localhost访问（某些浏览器限制）

**解决方案**（已应用）:
```javascript
// 添加兼容性检查
if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    updateStatus('您的浏览器不支持摄像头访问。请使用Chrome、Firefox或Edge浏览器。', 'error');
    return;
}
```

**建议**:
1. 使用最新版Chrome浏览器
2. 确保从局域网访问（http://192.168.111.172:8001）
3. 允许浏览器摄像头权限

---

**Q: 提示"无法访问摄像头"**

**A**: 可能原因：
1. 没有授予浏览器摄像头权限 → 检查浏览器设置
2. 摄像头被其他程序占用 → 关闭其他视频软件
3. 设备没有摄像头 → 更换有摄像头的设备

---

**Q: 无法访问 http://192.168.111.172:8001**

**A**: 检查清单：
1. ✅ 服务是否运行：`curl http://localhost:8001/health`
2. ✅ 防火墙是否开放8001端口
3. ✅ 设备是否在同一网络
4. ✅ IP地址是否正确

---

## 📱 推荐使用方式

### 方案1: 图片上传（最简单）✅

**适用**: 已有照片或自拍
**访问**: http://192.168.111.172:8001
**操作**:
1. 点击"图片上传"标签页
2. 选择照片
3. 查看识别结果

**优点**:
- ✅ 无需摄像头
- ✅ 支持所有浏览器
- ✅ 简单直接

---

### 方案2: 本地摄像头客户端 ✅

**适用**: 需要实时拍照识别
**访问**: http://192.168.111.172:8001/static/local_camera_client.html
**操作**:
1. 点击"启动本地摄像头"
2. 允许浏览器权限
3. 调整姿势
4. 点击"拍照并识别"
5. 查看结果

**优点**:
- ✅ 实时拍照
- ✅ 本地清晰度高
- ✅ 支持手机/平板
- ✅ 自动上传识别

---

## 🔧 端口说明

### 为什么不用7890端口？

```bash
$ ss -tlnp | grep 7890
LISTEN 0  128  127.0.0.1:7890  0.0.0.0:*
```

**原因**: 7890端口已被其他服务占用（可能是代理服务）

### 为什么改用8001端口？

- 8000端口是之前的默认配置
- 改为8001避免冲突
- 8001端口未被占用且可用

### 如何更改端口？

**修改文件**: `main.py` 第261行

```python
# 当前配置
uvicorn.run(app, host="0.0.0.0", port=8001, log_level="info")

# 如需更改为其他端口，例如8080:
uvicorn.run(app, host="0.0.0.0", port=8080, log_level="info")
```

**修改后重启服务**:
```bash
pkill -f "python main.py"
venv/bin/python main.py &
```

---

## 📊 当前系统状态

**服务状态**: ✅ 运行中
**服务端口**: 8001
**已加载人脸**: 1001个
**识别阈值**: tolerance=0.5
**准确率**:
- 已知人脸识别: 100%
- 陌生人拒绝: 12%
- 总体: 56%

---

## 🔍 测试访问

### 本地测试

```bash
# 健康检查
curl http://localhost:8001/health

# 查看人脸列表（前10个）
curl http://localhost:8001/api/known_faces | jq '.known_faces[:10]'

# 访问主页
curl http://localhost:8001/ | head -20
```

### 远程测试（从其他设备）

在浏览器打开：
```
http://192.168.111.172:8001
```

应该看到人脸识别系统主页。

---

## 📝 配置文件位置

**主配置**: `main.py`
- 端口配置: 第261行
- 服务地址: 0.0.0.0（监听所有网卡）

**客户端配置**: `static/local_camera_client.html`
- 默认服务器地址: 第208行
- 当前值: `http://192.168.111.172:8001`

---

## 🚨 故障排除

### 问题: 无法访问8001端口

**检查服务**:
```bash
ps aux | grep "python main.py"
ss -tlnp | grep 8001
```

**重启服务**:
```bash
pkill -f "python main.py"
venv/bin/python main.py &
```

### 问题: 摄像头无法启动

**浏览器兼容性**:
- 使用Chrome/Edge/Firefox最新版
- 不要使用IE浏览器

**权限设置**:
- Chrome: 地址栏左侧点击摄像头图标 → 允许
- Firefox: 地址栏左侧点击摄像头图标 → 允许
- Safari: Safari菜单 → 设置 → 网站 → 摄像头

### 问题: 识别结果不准确

**当前配置**:
- tolerance=0.5（较严格）

**优化方向**:
1. 调整tolerance=0.45（更严格）
2. 使用更清晰的照片
3. 确保光线充足

---

**最后更新**: 2026-01-08
**服务版本**: 1.0.1
