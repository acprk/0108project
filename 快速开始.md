# 快速开始指南

## ✅ 当前状态

**服务状态**: 运行中 🟢
**服务端口**: **8001** （已从8000更改）
**已加载人脸**: 1001个
**识别阈值**: tolerance=0.5

---

## 🚀 快速访问

### 主页面（图片上传）

**本地访问**:
```
http://localhost:8001
```

**局域网访问**（从其他设备）:
```
http://192.168.111.172:8001
```

### 摄像头客户端

**从有摄像头的设备访问**:
```
http://192.168.111.172:8001/static/local_camera_client.html
```

**支持设备**:
- ✅ 笔记本电脑
- ✅ 台式机（带摄像头）
- ✅ 手机
- ✅ 平板

---

## 📋 使用步骤

### 方法1: 图片上传识别（推荐）

1. 打开浏览器访问：http://192.168.111.172:8001
2. 点击"**图片上传**"标签页
3. 点击"选择文件"，上传照片
4. 等待识别结果（2-5秒）
5. 查看识别的名字

**优点**:
- ✅ 简单直接
- ✅ 无需摄像头
- ✅ 支持所有浏览器

---

### 方法2: 本地摄像头识别

#### 前提条件
- 设备有摄像头
- 设备与服务器在同一WiFi
- 使用Chrome/Edge/Firefox浏览器

#### 操作步骤

1. **打开客户端页面**
   ```
   http://192.168.111.172:8001/static/local_camera_client.html
   ```

2. **确认服务器地址**
   - 默认已填写：`http://192.168.111.172:8001`
   - 如需修改，在"服务器地址"输入框修改

3. **启动摄像头**
   - 点击"启动本地摄像头"按钮
   - 浏览器会请求摄像头权限，点击"允许"
   - 等待摄像头启动

4. **拍照识别**
   - 调整姿势
   - 点击"拍照并识别"
   - 照片自动上传到服务器
   - 等待识别结果（2-5秒）

5. **查看结果**
   - 识别成功会显示姓名
   - 如果是陌生人会显示"Unknown"

---

## 🔧 服务管理

### 启动服务（自动）

```bash
./start_service.sh
```

这会自动：
- 停止旧服务
- 检查端口占用
- 启动新服务
- 等待服务就绪
- 显示访问地址

---

### 启动服务（手动）

```bash
# 停止旧服务
pkill -f "python main.py"

# 启动新服务
venv/bin/python main.py &

# 查看日志
tail -f service.log
```

---

### 检查服务状态

```bash
# 健康检查
curl http://localhost:8001/health

# 输出示例:
# {"status":"healthy","known_faces_count":1001}

# 查看进程
ps aux | grep "python main.py"

# 查看端口
ss -tlnp | grep 8001
```

---

### 停止服务

```bash
pkill -f "python main.py"
```

---

## 🐛 故障排除

### 问题1: "Cannot read properties of undefined (reading 'getUserMedia')"

**原因**: 浏览器不支持或未授权摄像头访问

**解决方案**（已修复）:
1. ✅ 使用Chrome/Edge/Firefox最新版
2. ✅ 允许浏览器摄像头权限
3. ✅ 代码已添加兼容性检查

**如何授权摄像头**:
- **Chrome**: 地址栏左侧 → 点击锁图标 → 摄像头 → 允许
- **Firefox**: 地址栏左侧 → 点击图标 → 权限 → 摄像头 → 允许
- **Edge**: 地址栏右侧 → ... → 网站权限 → 摄像头 → 允许

---

### 问题2: 无法访问 http://192.168.111.172:8001

**可能原因**:
1. 服务未启动
2. 防火墙阻止
3. 设备不在同一网络
4. IP地址不正确

**检查清单**:

```bash
# 1. 检查服务是否运行
curl http://localhost:8001/health

# 2. 检查端口监听
ss -tlnp | grep 8001
# 应该显示: 0.0.0.0:8001

# 3. 检查IP地址
ip addr | grep "192.168"

# 4. 测试从本地访问
curl http://192.168.111.172:8001/health
```

**解决方案**:
- 如服务未运行 → 执行 `./start_service.sh`
- 如IP不对 → 修改为正确的服务器IP
- 如端口未监听 → 检查 service.log 日志

---

### 问题3: 端口冲突

**错误信息**: "Address already in use"

**解决方案**:
```bash
# 查找占用端口的进程
ss -tlnp | grep 8001

# 杀死占用进程（替换PID）
kill -9 <PID>

# 重启服务
./start_service.sh
```

---

### 问题4: 识别结果不准确

**当前配置**:
- 已知人脸识别率: 100%
- 陌生人拒绝率: 12%
- 总体准确率: 56%

**优化方向**:
1. 调整识别阈值（tolerance）
2. 使用高质量照片
3. 确保光线充足
4. 正面拍摄

**详细信息**: 查看 `最终测试对比报告.md`

---

## 📊 系统性能

### 识别速度
- **单张图片**: 2-5秒
- **加载时间**: 2-3分钟（1001个人脸）

### 准确率
- **已知人脸**: 100% ⭐⭐⭐⭐⭐
- **陌生人拒绝**: 12% ⭐
- **总体**: 56% ⭐⭐

### 资源占用
- **内存**: 约200-500MB
- **CPU**: 识别时高负载，空闲时低负载
- **磁盘**: 约200MB（人脸图片）

---

## 📚 相关文档

| 文档 | 说明 |
|-----|------|
| **端口和访问说明.md** | 端口配置、访问方式详解 |
| **最终测试对比报告.md** | 测试结果、性能分析 |
| **人脸识别技术原理.md** | 技术原理、算法详解 |
| **摄像头使用说明.md** | 摄像头问题解决方案 |
| **COMPLETE_GUIDE.md** | 完整使用指南 |

---

## 🔍 快速测试

### 测试1: 健康检查

```bash
curl http://localhost:8001/health
```

**预期输出**:
```json
{"status":"healthy","known_faces_count":1001}
```

---

### 测试2: 查看人脸列表

```bash
curl http://localhost:8001/api/known_faces
```

**预期输出**:
```json
{
  "success": true,
  "known_faces": ["小徐", "张三", "李四", ...],
  "total": 1001
}
```

---

### 测试3: 图片上传

1. 打开浏览器：http://localhost:8001
2. 点击"图片上传"
3. 上传测试照片：`自定义证件照_20240902.jpg`
4. 应识别为"小徐"

---

## ⚡ 重要提示

### ✅ 正常情况
- 服务器没有摄像头 → **正常**（使用本地摄像头客户端）
- 加载人脸需要2-3分钟 → **正常**（1001个人脸）
- 识别需要2-5秒 → **正常**（CPU模式）

### ⚠️ 需要注意
- 陌生人拒绝率较低 → 需要优化tolerance
- 非localhost访问可能需要HTTPS → 浏览器限制
- 大型数据库影响速度 → 考虑减少人脸数量

### ❌ 异常情况
- 服务无法启动 → 检查日志 `service.log`
- 端口被占用 → 使用 `start_service.sh` 自动处理
- 识别报错 → 检查图片格式和质量

---

## 💡 使用技巧

### 技巧1: 提高识别准确率
- 使用正面照片
- 确保光线充足
- 避免遮挡（口罩、墨镜）
- 使用高分辨率照片

### 技巧2: 加快识别速度
- 减少数据库人脸数量
- 使用更快的服务器
- 考虑使用GPU加速

### 技巧3: 批量测试
```bash
# 测试目录下所有图片
for img in test_set/known_faces/*.jpg; do
    echo "测试: $img"
    curl -X POST -F "file=@$img" http://localhost:8001/api/detect
    echo ""
done
```

---

## 🎯 下一步

1. ✅ 服务已运行，可以开始测试
2. 📸 使用图片上传或摄像头测试识别
3. 📊 查看测试报告了解性能
4. ⚙️ 根据需求优化tolerance参数

---

**最后更新**: 2026-01-08
**当前版本**: 1.0.1
**端口**: 8001
